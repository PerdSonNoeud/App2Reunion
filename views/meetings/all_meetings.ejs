<%- include('../partials/header') %>

<div class="meetings-container">
    <link rel="stylesheet" href="/css/all_meetings.css" type="text/css">
    <link rel="stylesheet" href="/css/calendar.css" type="text/css">
    
    <div class="header-container">
        <h1>Mes réunions</h1>
        <div class="view-controls">
            <a href="/import_meeting" class="btn-view">Importer</a>
            <button class="btn-view active" id="liste" data-view="list">Liste</button>
            <button class="btn-view" id="calendar" data-view="calendar">Calendrier</button>
        </div>
    </div>
    
    <div id="list-view">
        <% if (meetings && meetings.length > 0) { %>
            <table class="meetings-table">
                <thead>
                    <tr>
                        <th>Titre</th>
                        <th>Date</th>
                        <th>Heure</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% meetings.forEach(meeting => { %>
                        <tr>
                            <td><%= meeting.title %></td>
                            <td><%= new Date(meeting.start_time).toLocaleDateString() %></td>
                            <td><%= new Date(meeting.start_time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %></td>
                            <td>
                                <% if (meeting.uid === user.uid) { %>
                                    <span class="status-badge organizer">Organisateur</span>
                                <% } else if (meeting.status === 'confirmed') { %>
                                    <span class="status-badge confirmed">Confirmé</span>
                                <% } else if (meeting.status === 'declined') { %>
                                    <span class="status-badge declined">Décliné</span>
                                <% } else { %>
                                    <span class="status-badge pending">En attente</span>
                                <% } %>
                            </td>
                            <td>
                                <a href="/meetings/<%= meeting.mid %>" class="btn-detail">Détails</a>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        <% } else { %>
            <p class="no-meetings">Vous n'avez pas encore créé de réunion.</p>
        <% } %>
    </div>
    
    <div id="calendar-view" style="display: none;">
        <div id="calendar-container" class="calendar-container" data-meetings="<%= JSON.stringify(meetings) %>">
            <div class="calendar-header">
                <div id="month-year" class="month-year"></div>
                <div class="calendar-nav">
                    <button class="calendar-nav-btn" id="prev-month">&lt; Mois précédent</button>
                    <button class="calendar-nav-btn" id="next-month">Mois suivant &gt;</button>
                </div>
            </div>
            <div id="calendar-grid" class="calendar-grid">
            </div>
        </div>
    </div>
    
    <% if (!meetings || meetings.length === 0) { %>
        <div class="cta-container">
            <a href="/new_meeting" class="btn-primary">Créer ma première réunion</a>
        </div>
    <% } %>
</div>
<div class="import-result">
    <% if (valid) { %>
        <p class="success-message"><%= valid %></p>
    <% } %>
</div>

<%- include('../partials/footer') %>
